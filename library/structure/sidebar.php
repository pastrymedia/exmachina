<?php
/**
 * Hybrid Framework
 *
 * WARNING: This file is part of the core Hybrid Framework DO NOT edit this file under any circumstances.
 * Please do all modifications in the form of a child theme.
 *
 * @package Hybrid\Sidebars
 * @author  Machina Themes
 * @license GPL-2.0+
 * @link    http://machinathemes.com
 */


/* Add the primary sidebars after the main content. */
add_action( hybrid_get_prefix() . '_after_main', 'hybrid_after_main' );

/* Filter the sidebar widgets. */
add_filter( 'sidebars_widgets', 'hybrid_disable_sidebars' );
add_action( 'template_redirect', 'hybrid_one_column' );

/**
 * Display sidebar
 */
function hybrid_after_main() {
  get_sidebar();
}

/**
 * Disables sidebars if viewing a one-column page.
 */

function hybrid_disable_sidebars( $sidebars_widgets ) {
  global $wp_customize;

  $customize = ( is_object( $wp_customize ) && $wp_customize->is_preview() ) ? true : false;

  if ( !is_admin() && !$customize && '1c' == get_theme_mod( 'theme_layout' ) )
    $sidebars_widgets['primary'] = false;

  return $sidebars_widgets;
}

/**
 * Function for deciding which pages should have a one-column layout.
 */
function hybrid_one_column() {

  if ( !is_active_sidebar( 'primary' ) )
    add_filter( 'theme_mod_theme_layout', 'hybrid_theme_layout_one_column' );

  elseif ( is_attachment() && wp_attachment_is_image() && 'default' == get_post_layout( get_queried_object_id() ) )
    add_filter( 'theme_mod_theme_layout', 'hybrid_theme_layout_one_column' );

}


/**
 * Filters 'get_theme_layout' by returning 'layout-1c'.
 */
function hybrid_theme_layout_one_column( $layout ) {
  return '1c';
}

